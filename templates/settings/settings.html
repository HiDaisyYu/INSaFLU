{% extends '_layouts/base.html' %}

{% load bootstrap4 %}
{% load querystring from django_tables2 %}
{% load title from django_tables2 %}
{% load trans blocktrans from i18n %}
{% load django_bootstrap_breadcrumbs %}

{% block css %}
	{% load static from staticfiles %}
		<link rel="stylesheet" href="{% static 'css/flu-web-site.css' %}" type="text/css" />
		<link rel="stylesheet" href="{% static 'css/main-page.css' %}" type="text/css" />
{% endblock css %}

{% block extra_messages %}
	<!-- set the messages -->
	<div class="container">
		<div id="id_messages_set_default"></div>
	</div>
{% endblock extra_messages %}

{% block breadcrumbs %}
	{{ block.super }}
	
	<!-- can edit settings in project sample or to overall projects -->
	{% if project_settings %}
		{% breadcrumb "Projects" "projects" %}
		{% breadcrumb "Project settings" "project-settings" %}
	{% elif sample_project_settings %}
		{% breadcrumb "Projects" "projects" %}
		{% breadcrumb "Show project results" "show-sample-project-results" project_sample.project.pk %}
		{% breadcrumb "Project sample settings" "sample-project-settings" %}
	{% elif sample %}
		{% breadcrumb "Samples" "samples" %}
		{% breadcrumb "Samples settings" "sample-settings" sample.pk %}
	{% else %}
		{% breadcrumb "Settings" "settings" %}
	{% endif %}
{% endblock %}

{% block content %}

	{% if error_cant_see %}
		<hr>
		<p><strong>Project sample settings not available</strong></p>
	{% else %}
		
		<!-- Info settings -->
		<hr>
		<p class="insa-description-process" style="text-align: center;">Please choose <strong>your software settings</strong> 
				before uploading new samples to your account.</p>
		
		<!-- Table only of software -->
		{% if table %}
			{% if table.page and show_paginatior_table %}
			  <div class="table-container">
			{% endif %}
			
			{% block table %}
			    <div class="table-responsive">
			        <table class="table table-hover table-bordered table-striped"{% if table.attrs %} {{ table.attrs.as_html }}{% endif %}>
			            {% block table.thead %}
			            <thead>                 
			                <tr class="alert alert-primary">
			                    <th colspan="7">
			                    	{% if project_settings %}
			                    		<div class="header-software-settings">Software parameters for project: {{project.name}}</div>
			                    	{% elif sample_project_settings %}
			                    		<div class="header-software-settings">Software parameters for project: {{project_sample.project.name}} and sample: {{project_sample.sample.name}}</div>
			                    	{% elif sample %}
			                    		<div class="header-software-settings">Software parameters for sample: {{sample.name}}</div>
			                    	{% else %}
			                    		<div class="header-software-settings">Global software parameters</div>
			                    	{% endif %}
			                    </th>                  
			                </tr>
			             
			              <tr>
			                {% for column in table.columns %}
			                    {% if column.orderable %}
			                    	<th {{ column.attrs.th.as_html }}><a href="{% querystring table.prefixed_order_by_field=column.order_by_alias.next %}">{{ column.header|title }}</a></th>
			                    {% else %}
			                    	<th {{ column.attrs.th.as_html }}>{{ column.header|title }}</th>
			                    {% endif %}
			                {% endfor %}
			              </tr>
			            </thead>
			            {% endblock table.thead %}
			            {% block table.tbody %}
			            <tbody>
			                {% for row in table.page.object_list|default:table.rows %} {# support pagination #}
			                  {% block table.tbody.row %}
			                  <tr id="row_{{ row.record.id }}" class="{% cycle "odd" "even" %}">
			                      {% for column, cell in row.items %}
			                          <td {{ column.attrs.td.as_html }}>{{ cell }}</td>
			                      {% endfor %}
			                  </tr>
			                  {% endblock table.tbody.row %}
			                {% empty %}
			                  {% if table.empty_text %}
				                  {% block table.tbody.empty_text %}
				                  	<tr><td colspan="{{ table.columns|length }}">{{ table.empty_text }}</td></tr>
				                  {% endblock table.tbody.empty_text %}
			                  {% endif %}
			                {% endfor %}
			            </tbody>
			            {% endblock table.tbody %}
			            {% block table.tfoot %}
			            	<tfoot></tfoot>
			            {% endblock table.tfoot %}
			        </table>
			    </div>
			{% endblock table %}
			
			{% if table.page and show_paginatior_table %}
			    {% block pagination %}
			        {% bootstrap_pagination table.page url=request.get_full_path %}
			    {% endblock pagination %}
			  </div>
			{% endif %}
		{% endif %}
		<!-- END Table only of software -->

		<!-- Table for INSaFLU (GLOBAL) parameters -->
		{% if table_insaflu %}
			{% if table_insaflu.page and show_paginatior_table_insaflu %}
			  <div class="table-container">
			{% endif %}
			
			{% block table_insaflu %}
				<br>
			    <div class="table-responsive">
			        <table class="table table-hover table-bordered table-striped"{% if table_insaflu.attrs %} {{ table_insaflu.attrs.as_html }}{% endif %}>
			            {% block table_insaflu.thead %}
			            <thead>                 
			                <tr class="alert alert-primary">
			                    <th colspan="7">
			                    	{% if project_settings %}
			                    		<div class="header-software-settings">INSaFLU parameters for project: {{project.name}}</div>
			                    	{% elif sample_project_settings %}
			                    		<div class="header-software-settings">INSaFLU parameters for project: {{project_sample.project.name}} and sample: {{project_sample.sample.name}}</div>
			                    	{% elif sample %}
			                    		<div class="header-software-settings">Software parameters for sample: {{sample.name}}</div>
			                    	{% else %}
			                    		<div class="header-software-settings">Global INSaFLU parameters</div>
			                    	{% endif %}
			                    </th>                  
			                </tr>
			             
			              <tr>
			                {% for column in table_insaflu.columns %}
			                    {% if column.orderable %}
			                    	<th {{ column.attrs.th.as_html }}><a href="{% querystring table.prefixed_order_by_field=column.order_by_alias.next %}">{{ column.header|title }}</a></th>
			                    {% else %}
			                    	<th {{ column.attrs.th.as_html }}>{{ column.header|title }}</th>
			                    {% endif %}
			                {% endfor %}
			              </tr>
			            </thead>
			            {% endblock table_insaflu.thead %}
			            {% block table_insaflu.tbody %}
			            <tbody>
			                {% for row in table_insaflu.page.object_list|default:table_insaflu.rows %} {# support pagination #}
			                  {% block table_insaflu.tbody.row %}
			                  <tr id="row_{{ row.record.id }}" class="{% cycle "odd" "even" %}">
			                      {% for column, cell in row.items %}
			                          <td {{ column.attrs.td.as_html }}>{{ cell }}</td>
			                      {% endfor %}
			                  </tr>
			                  {% endblock table_insaflu.tbody.row %}
			                {% empty %}
			                  {% if table_insaflu.empty_text %}
				                  {% block table_insaflu.tbody.empty_text %}
				                  	<tr><td colspan="{{ table.columns|length }}">{{ table_insaflu.empty_text }}</td></tr>
				                  {% endblock table_insaflu.tbody.empty_text %}
			                  {% endif %}
			                {% endfor %}
			            </tbody>
			            {% endblock table_insaflu.tbody %}
			            {% block table_insaflu.tfoot %}
			            	<tfoot></tfoot>
			            {% endblock table_insaflu.tfoot %}
			        </table>
			    </div>
			{% endblock table_insaflu %}
			
			{% if table_insaflu.page and show_paginatior_table_insaflu %}
			    {% block table_insaflu_pagination %}
			        {% bootstrap_pagination table_insaflu.page url=request.get_full_path %}
			    {% endblock table_insaflu_pagination %}
			  </div>
			{% endif %}
		{% endif %}
		<!-- END Table for INSaFLU (GLOBAL) parameters-->
		
		<br>
		<p class="insa-description bg-insa-fixed-top" style=""><strong>Note:</strong> that you should fit the parameters
			to the conditions you are working with, e.g., default endâ€™s trimming size for ONT may be
			too restrictive depending on design of your tiling amplicon multiplex PCR method and on
			your sequencing protocol (if reads are or not already trimmed/clipped).</p>
			
		<!--  in project view you cannot change settings if it has one or more sample add -->
		{% if message_not_change_settings %}
			<br>
			<div class="alert alert-warning" role="alert">{{message_not_change_settings}}</div>
		{% endif %}
		
		<!--  Go back  function -->	
		{% if project_settings %}
			<br>
			<a href="{% url 'projects' %}" class="btn btn-small btn-primary dark"><i class="fa fa-arrow-left"></i> Go back</a>
		{% elif sample_project_settings %}
			<br>
			<a href="{% url 'show-sample-project-results' project_sample.project.pk %}" class="btn btn-small btn-primary dark"><i class="fa fa-arrow-left"></i> Go back</a>
		{% elif sample_settings %}
			<br>
			<a href="{% url 'samples' %}" class="btn btn-small btn-primary dark"><i class="fa fa-arrow-left"></i> Go back</a>
		{% endif %}
		
		<!-- Set default Modal -->
		<div class="modal fade" id="id_set_default_modal" >
			<div class="modal-dialog">
				<div class="modal-content">
	   
	  					<!-- Modal Header -->
	  					<div class="modal-header alert alert-warning">
	    					<h4 class="modal-title-remove">Set default parameters</h4>
	    					<button type="button" class="close" data-dismiss="modal">&times;</button>
	  					</div>
	  
	  					<!-- Modal body -->
	  					<div class="modal-body mx-auto mw-100">
	  						<div id="id-modal-body-set-default" remove-single-value-url="{% url 'default_parameters' %}">
	  							<label id="id-label-set-default" class="col-form-label">Folder Name</label>
	   						</div>
	  					</div>
	  					<!-- Modal footer -->
	  					<div class="modal-footer" id="id-modal-footer-remove">
	    					<button id="id-set-default-button" type="button" class="btn btn-primary" data-dismiss="modal">Set default</button>
	    					<button type="button" class="btn btn-secondary" data-dismiss="modal" aria-hidden="true">Cancel</button>
	  					</div>
				</div>
	 		</div>
		</div>
	{% endif %}   <!-- error_cant_see -->
{% endblock content %}

{% block js %}
	{% load static %}
		<script type="text/javascript" src="{% static 'js/set-default-parameters.js' %}"></script>
{% endblock %}
